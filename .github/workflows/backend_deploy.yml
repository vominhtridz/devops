name: Deploy Backend to Render

on:
  push:
    branches:
      - main
    paths:
      - 'backend/**' # CHỈ KÍCH HOẠT khi có thay đổi trong thư mục backend/
      - '.github/workflows/backend_deploy.yml'

jobs:
  deploy_backend:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # CI - Build/Test Backend: Cần thiết để đảm bảo môi trường Node.js được thiết lập
      - name: Setup Node.js Environment
        uses: actions/setup-node@v4
        with:
          node-version: '14.21.3' # Sử dụng phiên bản Node.js hiện đại hơn

      - name: Install Dependencies
        # Chuyển vào thư mục backend trước khi cài đặt
        run: cd backend && npm install

      # (Tùy chọn) Chạy build step nếu backend của bạn cần build (ví dụ: TypeScript)
      # - name: Build Backend
      #   run: cd backend && npm run build

      - name: Deploy Backend to Render
        uses: render-examples/deploy-action@v1
        with:
          api-key: ${{ secrets.RENDER_API_KEY }}
          # Đảm bảo bạn đã định nghĩa secret có tên RENDER_SERVICE_ID
          # Giá trị của secret này phải là ID dịch vụ Render của bạn (ví dụ: srv-d4nr0cf5r7bs73c5r0eg)
          service-id: srv-d4nr0cf5r7bs73c5r0eg
          # Chỉ định rõ là Web Service
          type: web