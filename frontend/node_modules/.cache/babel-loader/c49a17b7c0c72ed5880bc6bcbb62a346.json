{"ast":null,"code":"import _toConsumableArray from\"D:/devops/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:/devops/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React,{Fragment,useState,useEffect}from'react';import MetaData from'../layout/MetaData';import Sidebar from'./Sidebar';import{useAlert}from'react-alert';import{useDispatch,useSelector}from'react-redux';import{updateProduct,getProductDetails,clearErrors}from'../../actions/productActions';import{UPDATE_PRODUCT_RESET}from'../../constants/productConstants';var UpdateProduct=function UpdateProduct(_ref){var match=_ref.match,history=_ref.history;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),name=_useState2[0],setName=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),price=_useState4[0],setPrice=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),description=_useState6[0],setDescription=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),category=_useState8[0],setCategory=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),stock=_useState10[0],setStock=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),seller=_useState12[0],setSeller=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),images=_useState14[0],setImages=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),oldImages=_useState16[0],setOldImages=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),imagesPreview=_useState18[0],setImagesPreview=_useState18[1];var categories=['Rau-Củ-Trái cây','Rau-Củ-Trái cây','Thịt-Trứng-Hải sản','Thực phẩm chế biến','Thực phẩm đông lạnh','Thực phẩm Khô - Gia Vị','Bánh kẹo - Đồ ăn vặt',\"Sữa - Sản phẩm từ sữa\",'Đồ uống - Giải khát','Hóa Mỹ phẩm','Chăm sóc cá nhân','Chăm sóc mẹ và bé','Thể thao'];var alert=useAlert();var dispatch=useDispatch();var _useSelector=useSelector(function(state){return state.productDetails;}),error=_useSelector.error,product=_useSelector.product;var _useSelector2=useSelector(function(state){return state.product;}),loading=_useSelector2.loading,updateError=_useSelector2.error,isUpdated=_useSelector2.isUpdated;var productId=match.params.id;useEffect(function(){if(product&&product._id!==productId){dispatch(getProductDetails(productId));}else{setName(product.name);setPrice(product.price);setDescription(product.description);setCategory(product.category);setSeller(product.seller);setStock(product.stock);setOldImages(product.images);}if(error){alert.error(error);dispatch(clearErrors());}if(updateError){alert.error(updateError);dispatch(clearErrors());}if(isUpdated){history.push('/admin/products');alert.success('Product updated successfully');dispatch({type:UPDATE_PRODUCT_RESET});}},[dispatch,alert,error,isUpdated,history,updateError,product,productId]);var submitHandler=function submitHandler(e){e.preventDefault();var formData=new FormData();formData.set('name',name);formData.set('price',price);formData.set('description',description);formData.set('category',category);formData.set('stock',stock);formData.set('seller',seller);images.forEach(function(image){formData.append('images',image);});dispatch(updateProduct(product._id,formData));};var onChange=function onChange(e){var files=Array.from(e.target.files);setImagesPreview([]);setImages([]);setOldImages([]);files.forEach(function(file){var reader=new FileReader();reader.onload=function(){if(reader.readyState===2){setImagesPreview(function(oldArray){return[].concat(_toConsumableArray(oldArray),[reader.result]);});setImages(function(oldArray){return[].concat(_toConsumableArray(oldArray),[reader.result]);});}};reader.readAsDataURL(file);});};return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(MetaData,{title:'Update Product'}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-12 col-md-2\",children:/*#__PURE__*/_jsx(Sidebar,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-12 col-md-10\",children:/*#__PURE__*/_jsx(Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"wrapper my-5\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"shadow-lg\",onSubmit:submitHandler,encType:\"multipart/form-data\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"mb-4\",children:\"C\\u1EADp nh\\u1EADt s\\u1EA3n ph\\u1EA9m\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"name_field\",children:\"T\\xEAn s\\u1EA3n ph\\u1EA9m\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"name_field\",className:\"form-control\",value:name,onChange:function onChange(e){return setName(e.target.value);}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"price_field\",children:\"Gi\\xE1\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"price_field\",className:\"form-control\",value:price,onChange:function onChange(e){return setPrice(e.target.value);}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"description_field\",children:\"M\\xF4 t\\u1EA3\"}),/*#__PURE__*/_jsx(\"textarea\",{className:\"form-control\",id:\"description_field\",rows:\"8\",value:description,onChange:function onChange(e){return setDescription(e.target.value);}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"category_field\",children:\"Danh m\\u1EE5c\"}),/*#__PURE__*/_jsx(\"select\",{className:\"form-control\",id:\"category_field\",value:category,onChange:function onChange(e){return setCategory(e.target.value);},children:categories.map(function(category){return/*#__PURE__*/_jsx(\"option\",{value:category,children:category},category);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"stock_field\",children:\"S\\u1ED1 l\\u01B0\\u1EE3ng\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",id:\"stock_field\",className:\"form-control\",value:stock,onChange:function onChange(e){return setStock(e.target.value);}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"seller_field\",children:\"Xu\\u1EA5t x\\u1EE9\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"seller_field\",className:\"form-control\",value:seller,onChange:function onChange(e){return setSeller(e.target.value);}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u1EA2nh\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"custom-file\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"product_images\",className:\"custom-file-input\",id:\"customFile\",onChange:onChange,multiple:true}),/*#__PURE__*/_jsx(\"label\",{className:\"custom-file-label\",htmlFor:\"customFile\",children:\"Ch\\u1ECDn h\\xECnh\"})]}),oldImages&&oldImages.map(function(img){return/*#__PURE__*/_jsx(\"img\",{src:img.url,alt:img.url,className:\"mt-3 mr-2\",width:\"55\",height:\"52\"},img);}),imagesPreview.map(function(img){return/*#__PURE__*/_jsx(\"img\",{src:img,alt:\"Images Preview\",className:\"mt-3 mr-2\",width:\"55\",height:\"52\"},img);})]}),/*#__PURE__*/_jsx(\"button\",{id:\"login_button\",type:\"submit\",className:\"btn btn-block py-3\",disabled:loading?true:false,children:\"C\\u1EADp nh\\u1EADt\"})]})})})})]})]});};export default UpdateProduct;","map":{"version":3,"sources":["D:/devops/frontend/src/components/admin/UpdateProduct.js"],"names":["React","Fragment","useState","useEffect","MetaData","Sidebar","useAlert","useDispatch","useSelector","updateProduct","getProductDetails","clearErrors","UPDATE_PRODUCT_RESET","UpdateProduct","match","history","name","setName","price","setPrice","description","setDescription","category","setCategory","stock","setStock","seller","setSeller","images","setImages","oldImages","setOldImages","imagesPreview","setImagesPreview","categories","alert","dispatch","state","productDetails","error","product","loading","updateError","isUpdated","productId","params","id","_id","push","success","type","submitHandler","e","preventDefault","formData","FormData","set","forEach","image","append","onChange","files","Array","from","target","file","reader","FileReader","onload","readyState","oldArray","result","readAsDataURL","value","map","img","url"],"mappings":"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","sourcesContent":["import React, { Fragment, useState, useEffect } from 'react'\r\n\r\nimport MetaData from '../layout/MetaData'\r\nimport Sidebar from './Sidebar'\r\n\r\nimport { useAlert } from 'react-alert'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { updateProduct, getProductDetails, clearErrors } from '../../actions/productActions'\r\nimport { UPDATE_PRODUCT_RESET } from '../../constants/productConstants'\r\n\r\nconst UpdateProduct = ({ match, history }) => {\r\n\r\n    const [name, setName] = useState('');\r\n    const [price, setPrice] = useState(0);\r\n    const [description, setDescription] = useState('');\r\n    const [category, setCategory] = useState('');\r\n    const [stock, setStock] = useState(0);\r\n    const [seller, setSeller] = useState('');\r\n    const [images, setImages] = useState([]);\r\n\r\n    const [oldImages, setOldImages] = useState([]);\r\n    const [imagesPreview, setImagesPreview] = useState([])\r\n\r\n    const categories = [\r\n        'Rau-Củ-Trái cây',\r\n        'Rau-Củ-Trái cây',\r\n        'Thịt-Trứng-Hải sản',\r\n        'Thực phẩm chế biến',\r\n        'Thực phẩm đông lạnh',\r\n        'Thực phẩm Khô - Gia Vị',\r\n        'Bánh kẹo - Đồ ăn vặt',\r\n        \"Sữa - Sản phẩm từ sữa\",\r\n        'Đồ uống - Giải khát',\r\n        'Hóa Mỹ phẩm',\r\n        'Chăm sóc cá nhân',\r\n        'Chăm sóc mẹ và bé',\r\n        'Thể thao'\r\n    ]\r\n\r\n    const alert = useAlert();\r\n    const dispatch = useDispatch();\r\n\r\n    const { error, product } = useSelector(state => state.productDetails)\r\n    const { loading, error: updateError, isUpdated } = useSelector(state => state.product);\r\n\r\n    const productId = match.params.id;\r\n\r\n    useEffect(() => {\r\n\r\n        if (product && product._id !== productId) {\r\n            dispatch(getProductDetails(productId));\r\n        } else {\r\n            setName(product.name);\r\n            setPrice(product.price);\r\n            setDescription(product.description);\r\n            setCategory(product.category);\r\n            setSeller(product.seller);\r\n            setStock(product.stock)\r\n            setOldImages(product.images)\r\n        }\r\n\r\n        if (error) {\r\n            alert.error(error);\r\n            dispatch(clearErrors())\r\n        }\r\n\r\n        if (updateError) {\r\n            alert.error(updateError);\r\n            dispatch(clearErrors())\r\n        }\r\n\r\n\r\n        if (isUpdated) {\r\n            history.push('/admin/products');\r\n            alert.success('Product updated successfully');\r\n            dispatch({ type: UPDATE_PRODUCT_RESET })\r\n        }\r\n\r\n    }, [dispatch, alert, error, isUpdated, history, updateError, product, productId])\r\n\r\n\r\n    const submitHandler = (e) => {\r\n        e.preventDefault();\r\n\r\n        const formData = new FormData();\r\n        formData.set('name', name);\r\n        formData.set('price', price);\r\n        formData.set('description', description);\r\n        formData.set('category', category);\r\n        formData.set('stock', stock);\r\n        formData.set('seller', seller);\r\n\r\n        images.forEach(image => {\r\n            formData.append('images', image)\r\n        })\r\n\r\n        dispatch(updateProduct(product._id, formData))\r\n    }\r\n\r\n    const onChange = e => {\r\n\r\n        const files = Array.from(e.target.files)\r\n\r\n        setImagesPreview([]);\r\n        setImages([])\r\n        setOldImages([])\r\n\r\n        files.forEach(file => {\r\n            const reader = new FileReader();\r\n\r\n            reader.onload = () => {\r\n                if (reader.readyState === 2) {\r\n                    setImagesPreview(oldArray => [...oldArray, reader.result])\r\n                    setImages(oldArray => [...oldArray, reader.result])\r\n                }\r\n            }\r\n\r\n            reader.readAsDataURL(file)\r\n        })\r\n    }\r\n\r\n\r\n    return (\r\n        <Fragment>\r\n            <MetaData title={'Update Product'} />\r\n            <div className=\"row\">\r\n                <div className=\"col-12 col-md-2\">\r\n                    <Sidebar />\r\n                </div>\r\n\r\n                <div className=\"col-12 col-md-10\">\r\n                    <Fragment>\r\n                        <div className=\"wrapper my-5\">\r\n                            <form className=\"shadow-lg\" onSubmit={submitHandler} encType='multipart/form-data'>\r\n                                <h1 className=\"mb-4\">Cập nhật sản phẩm</h1>\r\n\r\n                                <div className=\"form-group\">\r\n                                    <label htmlFor=\"name_field\">Tên sản phẩm</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        id=\"name_field\"\r\n                                        className=\"form-control\"\r\n                                        value={name}\r\n                                        onChange={(e) => setName(e.target.value)}\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"form-group\">\r\n                                    <label htmlFor=\"price_field\">Giá</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        id=\"price_field\"\r\n                                        className=\"form-control\"\r\n                                        value={price}\r\n                                        onChange={(e) => setPrice(e.target.value)}\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"form-group\">\r\n                                    <label htmlFor=\"description_field\">Mô tả</label>\r\n                                    <textarea className=\"form-control\" id=\"description_field\" rows=\"8\" value={description} onChange={(e) => setDescription(e.target.value)}></textarea>\r\n                                </div>\r\n\r\n                                <div className=\"form-group\">\r\n                                    <label htmlFor=\"category_field\">Danh mục</label>\r\n                                    <select className=\"form-control\" id=\"category_field\" value={category} onChange={(e) => setCategory(e.target.value)}>\r\n                                        {categories.map(category => (\r\n                                            <option key={category} value={category} >{category}</option>\r\n                                        ))}\r\n\r\n                                    </select>\r\n                                </div>\r\n                                <div className=\"form-group\">\r\n                                    <label htmlFor=\"stock_field\">Số lượng</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        id=\"stock_field\"\r\n                                        className=\"form-control\"\r\n                                        value={stock}\r\n                                        onChange={(e) => setStock(e.target.value)}\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"form-group\">\r\n                                    <label htmlFor=\"seller_field\">Xuất xứ</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        id=\"seller_field\"\r\n                                        className=\"form-control\"\r\n                                        value={seller}\r\n                                        onChange={(e) => setSeller(e.target.value)}\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className='form-group'>\r\n                                    <label>Ảnh</label>\r\n\r\n                                    <div className='custom-file'>\r\n                                        <input\r\n                                            type='file'\r\n                                            name='product_images'\r\n                                            className='custom-file-input'\r\n                                            id='customFile'\r\n                                            onChange={onChange}\r\n                                            multiple\r\n                                        />\r\n                                        <label className='custom-file-label' htmlFor='customFile'>\r\n                                            Chọn hình\r\n                                 </label>\r\n                                    </div>\r\n\r\n                                    {oldImages && oldImages.map(img => (\r\n                                        <img key={img} src={img.url} alt={img.url} className=\"mt-3 mr-2\" width=\"55\" height=\"52\" />\r\n                                    ))}\r\n\r\n                                    {imagesPreview.map(img => (\r\n                                        <img src={img} key={img} alt=\"Images Preview\" className=\"mt-3 mr-2\" width=\"55\" height=\"52\" />\r\n                                    ))}\r\n\r\n                                </div>\r\n\r\n\r\n                                <button\r\n                                    id=\"login_button\"\r\n                                    type=\"submit\"\r\n                                    className=\"btn btn-block py-3\"\r\n                                    disabled={loading ? true : false}\r\n                                >\r\n                                    Cập nhật\r\n                            </button>\r\n\r\n                            </form>\r\n                        </div>\r\n                    </Fragment>\r\n                </div>\r\n            </div>\r\n\r\n        </Fragment>\r\n    )\r\n}\r\n\r\nexport default UpdateProduct\r\n"]},"metadata":{},"sourceType":"module"}