{"ast":null,"code":"import _slicedToArray from\"D:/devops/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{Fragment,useState,useEffect}from'react';import{Carousel}from'react-bootstrap';import Loader from'../layout/Loader';import MetaData from'../layout/MetaData';import ListReviews from'../review/ListReviews';import{useAlert}from'react-alert';import{useDispatch,useSelector}from'react-redux';import{getProductDetails,newReview,clearErrors}from'../../actions/productActions';import{addItemToCart}from'../../actions/cartActions';import{NEW_REVIEW_RESET}from'../../constants/productConstants';var ProductDetails=function ProductDetails(_ref){var match=_ref.match;var _useState=useState(1),_useState2=_slicedToArray(_useState,2),quantity=_useState2[0],setQuantity=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),rating=_useState4[0],setRating=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),comment=_useState6[0],setComment=_useState6[1];var dispatch=useDispatch();var alert=useAlert();var _useSelector=useSelector(function(state){return state.productDetails;}),loading=_useSelector.loading,error=_useSelector.error,product=_useSelector.product;var _useSelector2=useSelector(function(state){return state.auth;}),user=_useSelector2.user;var _useSelector3=useSelector(function(state){return state.newReview;}),reviewError=_useSelector3.error,success=_useSelector3.success;useEffect(function(){dispatch(getProductDetails(match.params.id));if(error){alert.error(error);dispatch(clearErrors());}if(reviewError){alert.error(reviewError);dispatch(clearErrors());}if(success){alert.success('Đánh giá thành công');dispatch({type:NEW_REVIEW_RESET});}},[dispatch,alert,error,reviewError,match.params.id,success]);var addToCart=function addToCart(){dispatch(addItemToCart(match.params.id,quantity));alert.success('Đã thêm vào giỏ hàng');};var increaseQty=function increaseQty(){var count=document.querySelector('.count');if(count.valueAsNumber>=product.stock)return;var qty=count.valueAsNumber+1;setQuantity(qty);};var decreaseQty=function decreaseQty(){var count=document.querySelector('.count');if(count.valueAsNumber<=1)return;var qty=count.valueAsNumber-1;setQuantity(qty);};function setUserRatings(){var stars=document.querySelectorAll('.star');stars.forEach(function(star,index){star.starValue=index+1;['click','mouseover','mouseout'].forEach(function(e){star.addEventListener(e,showRatings);});});function showRatings(e){var _this=this;stars.forEach(function(star,index){if(e.type==='click'){if(index<_this.starValue){star.classList.add('orange');setRating(_this.starValue);}else{star.classList.remove('orange');}}if(e.type==='mouseover'){if(index<_this.starValue){star.classList.add('yellow');}else{star.classList.remove('yellow');}}if(e.type==='mouseout'){star.classList.remove('yellow');}});}}var reviewHandler=function reviewHandler(){var formData=new FormData();formData.set('rating',rating);formData.set('comment',comment);formData.set('productId',match.params.id);dispatch(newReview(formData));};return/*#__PURE__*/_jsx(Fragment,{children:loading?/*#__PURE__*/_jsx(Loader,{}):/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(MetaData,{title:product.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"row d-flex justify-content-around\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-12 col-lg-5 img-fluid\",id:\"product_image\",children:/*#__PURE__*/_jsx(Carousel,{pause:\"hover\",children:product.images&&product.images.map(function(image){return/*#__PURE__*/_jsx(Carousel.Item,{children:/*#__PURE__*/_jsx(\"img\",{className:\"d-block w-100\",src:image.url,alt:product.title})},image.public_id);})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-12 col-lg-5 mt-5\",children:[/*#__PURE__*/_jsx(\"h3\",{children:product.name}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"rating-outer\",children:[/*#__PURE__*/_jsx(\"span\",{id:\"no_of_reviews\",children:product.ratings}),/*#__PURE__*/_jsx(\"div\",{className:\"rating-inner\",style:{width:\"\".concat(product.ratings/5*100,\"%\")}})]}),/*#__PURE__*/_jsxs(\"span\",{id:\"no_of_reviews\",children:[\"(\",product.numOfReviews,\" \\u0111\\xE1nh gi\\xE1)\"]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"p\",{id:\"product_price\",children:[product.price,\"\\u0111\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stockCounter d-inline\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"btn btn-danger minus\",onClick:decreaseQty,children:\"-\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"form-control count d-inline\",value:quantity,readOnly:true}),/*#__PURE__*/_jsx(\"span\",{className:\"btn btn-primary plus\",onClick:increaseQty,children:\"+\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",id:\"cart_btn\",className:\"btn btn-primary d-inline ml-4\",disabled:product.stock===0,onClick:addToCart,children:\"Th\\xEAm v\\xE0o gi\\u1ECF h\\xE0ng\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"p\",{children:[\"T\\xECnh tr\\u1EA1ng h\\xE0ng: \",/*#__PURE__*/_jsx(\"span\",{id:\"stock_status\",className:product.stock>0?'greenColor':'redColor',children:product.stock>0?'Còn hàng':'Hết hàng'})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"h4\",{className:\"mt-2\",children:\"M\\xF4 t\\u1EA3:\"}),/*#__PURE__*/_jsx(\"p\",{children:product.description}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"p\",{id:\"product_seller mb-3\",children:[\"Xu\\u1EA5t x\\u1EE9: \",/*#__PURE__*/_jsx(\"strong\",{children:product.seller})]}),user?/*#__PURE__*/_jsx(\"button\",{id:\"review_btn\",type:\"button\",className:\"btn btn-primary mt-4\",\"data-toggle\":\"modal\",\"data-target\":\"#ratingModal\",onClick:setUserRatings,children:\"B\\xECnh lu\\u1EADn s\\u1EA3n ph\\u1EA9m\"}):/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger mt-5\",type:\"alert\",children:\"B\\u1EA1n c\\u1EA7n \\u0111\\u0103ng nh\\u1EADp \\u0111\\u1EC3 c\\xF3 th\\u1EC3 \\u0111\\xE1nh gi\\xE1 \\u0111\\u01B0\\u1EE3c s\\u1EA3n ph\\u1EA9m n\\xE0y.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"row mt-2 mb-5\",children:/*#__PURE__*/_jsx(\"div\",{className:\"rating w-50\",children:/*#__PURE__*/_jsx(\"div\",{className:\"modal fade\",id:\"ratingModal\",tabIndex:\"-1\",role:\"dialog\",\"aria-labelledby\":\"ratingModalLabel\",\"aria-hidden\":\"true\",children:/*#__PURE__*/_jsx(\"div\",{className:\"modal-dialog\",role:\"document\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"modal-title\",id:\"ratingModalLabel\",children:\"\\u0110\\xE1nh gi\\xE1 s\\u1EA3n ph\\u1EA9m\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"close\",\"data-dismiss\":\"modal\",\"aria-label\":\"Close\",children:/*#__PURE__*/_jsx(\"span\",{\"aria-hidden\":\"true\",children:\"\\xD7\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsxs(\"ul\",{className:\"stars\",children:[/*#__PURE__*/_jsx(\"li\",{className:\"star\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-star\"})}),/*#__PURE__*/_jsx(\"li\",{className:\"star\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-star\"})}),/*#__PURE__*/_jsx(\"li\",{className:\"star\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-star\"})}),/*#__PURE__*/_jsx(\"li\",{className:\"star\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-star\"})}),/*#__PURE__*/_jsx(\"li\",{className:\"star\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-star\"})})]}),/*#__PURE__*/_jsx(\"textarea\",{name:\"review\",id:\"review\",className:\"form-control mt-3\",value:comment,onChange:function onChange(e){return setComment(e.target.value);}}),/*#__PURE__*/_jsx(\"button\",{className:\"btn my-3 float-right review-btn px-4 bg-primary\",onClick:reviewHandler,\"data-dismiss\":\"modal\",\"aria-label\":\"Close\",children:\"G\\u1EEDi b\\xECnh lu\\u1EADn\"})]})]})})})})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:product.reviews&&product.reviews.length>0&&/*#__PURE__*/_jsx(ListReviews,{reviews:product.reviews})})]})});};export default ProductDetails;","map":{"version":3,"sources":["D:/devops/frontend/src/components/product/ProductDetails.js"],"names":["React","Fragment","useState","useEffect","Carousel","Loader","MetaData","ListReviews","useAlert","useDispatch","useSelector","getProductDetails","newReview","clearErrors","addItemToCart","NEW_REVIEW_RESET","ProductDetails","match","quantity","setQuantity","rating","setRating","comment","setComment","dispatch","alert","state","productDetails","loading","error","product","auth","user","reviewError","success","params","id","type","addToCart","increaseQty","count","document","querySelector","valueAsNumber","stock","qty","decreaseQty","setUserRatings","stars","querySelectorAll","forEach","star","index","starValue","e","addEventListener","showRatings","classList","add","remove","reviewHandler","formData","FormData","set","name","images","map","image","url","title","public_id","ratings","width","numOfReviews","price","description","seller","target","value","reviews","length"],"mappings":"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","sourcesContent":["import React, { Fragment, useState, useEffect } from 'react'\r\nimport { Carousel } from 'react-bootstrap'\r\n\r\nimport Loader from '../layout/Loader'\r\nimport MetaData from '../layout/MetaData'\r\nimport ListReviews from '../review/ListReviews'\r\n\r\nimport { useAlert } from 'react-alert'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { getProductDetails, newReview, clearErrors } from '../../actions/productActions'\r\nimport { addItemToCart } from '../../actions/cartActions'\r\nimport { NEW_REVIEW_RESET } from '../../constants/productConstants'\r\n\r\nconst ProductDetails = ({ match }) => {\r\n\r\n    const [quantity, setQuantity] = useState(1)\r\n    const [rating, setRating] = useState(0);\r\n    const [comment, setComment] = useState('');\r\n\r\n    const dispatch = useDispatch();\r\n    const alert = useAlert();\r\n\r\n    const { loading, error, product } = useSelector(state => state.productDetails)\r\n    const { user } = useSelector(state => state.auth)\r\n    const { error: reviewError, success } = useSelector(state => state.newReview)\r\n\r\n    useEffect(() => {\r\n        dispatch(getProductDetails(match.params.id))\r\n\r\n        if (error) {\r\n            alert.error(error);\r\n            dispatch(clearErrors())\r\n        }\r\n\r\n        if (reviewError) {\r\n            alert.error(reviewError);\r\n            dispatch(clearErrors())\r\n        }\r\n\r\n        if (success) {\r\n            alert.success('Đánh giá thành công')\r\n            dispatch({ type: NEW_REVIEW_RESET })\r\n        }\r\n\r\n    }, [dispatch, alert, error, reviewError, match.params.id, success])\r\n\r\n    const addToCart = () => {\r\n        dispatch(addItemToCart(match.params.id, quantity));\r\n        alert.success('Đã thêm vào giỏ hàng')\r\n    }\r\n\r\n    const increaseQty = () => {\r\n        const count = document.querySelector('.count')\r\n\r\n        if (count.valueAsNumber >= product.stock) return;\r\n\r\n        const qty = count.valueAsNumber + 1;\r\n        setQuantity(qty)\r\n    }\r\n\r\n    const decreaseQty = () => {\r\n\r\n        const count = document.querySelector('.count')\r\n\r\n        if (count.valueAsNumber <= 1) return;\r\n\r\n        const qty = count.valueAsNumber - 1;\r\n        setQuantity(qty)\r\n\r\n    }\r\n\r\n    function setUserRatings() {\r\n        const stars = document.querySelectorAll('.star');\r\n\r\n        stars.forEach((star, index) => {\r\n            star.starValue = index + 1;\r\n\r\n            ['click', 'mouseover', 'mouseout'].forEach(function (e) {\r\n                star.addEventListener(e, showRatings);\r\n            })\r\n        })\r\n\r\n        function showRatings(e) {\r\n            stars.forEach((star, index) => {\r\n                if (e.type === 'click') {\r\n                    if (index < this.starValue) {\r\n                        star.classList.add('orange');\r\n\r\n                        setRating(this.starValue)\r\n                    } else {\r\n                        star.classList.remove('orange')\r\n                    }\r\n                }\r\n\r\n                if (e.type === 'mouseover') {\r\n                    if (index < this.starValue) {\r\n                        star.classList.add('yellow');\r\n                    } else {\r\n                        star.classList.remove('yellow')\r\n                    }\r\n                }\r\n\r\n                if (e.type === 'mouseout') {\r\n                    star.classList.remove('yellow')\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    const reviewHandler = () => {\r\n        const formData = new FormData();\r\n\r\n        formData.set('rating', rating);\r\n        formData.set('comment', comment);\r\n        formData.set('productId', match.params.id);\r\n\r\n        dispatch(newReview(formData));\r\n    }\r\n    return (\r\n        <Fragment>\r\n            {loading ? <Loader /> : (\r\n                <Fragment>\r\n                    <MetaData title={product.name} />\r\n                    <div className=\"row d-flex justify-content-around\">\r\n                        <div className=\"col-12 col-lg-5 img-fluid\" id=\"product_image\">\r\n                            <Carousel pause='hover'>\r\n                                {product.images && product.images.map(image => (\r\n                                    <Carousel.Item key={image.public_id}>\r\n                                        <img className=\"d-block w-100\" src={image.url} alt={product.title} />\r\n                                    </Carousel.Item>\r\n                                ))}\r\n                            </Carousel>\r\n                        </div>\r\n\r\n                        <div className=\"col-12 col-lg-5 mt-5\">\r\n                            <h3>{product.name}</h3>\r\n                            <hr />\r\n\r\n                            <div className=\"rating-outer\">\r\n                                <span id=\"no_of_reviews\">{product.ratings}</span>\r\n                                <div className=\"rating-inner\" style={{ width: `${(product.ratings / 5) * 100}%` }}></div>\r\n                            </div>\r\n                            <span id=\"no_of_reviews\">({product.numOfReviews} đánh giá)</span>\r\n\r\n                            <hr />\r\n                            <p id=\"product_price\">{product.price}đ</p>\r\n                            <div className=\"stockCounter d-inline\">\r\n                                <span className=\"btn btn-danger minus\" onClick={decreaseQty}>-</span>\r\n\r\n                                <input type=\"number\" className=\"form-control count d-inline\" value={quantity} readOnly />\r\n\r\n                                <span className=\"btn btn-primary plus\" onClick={increaseQty}>+</span>\r\n                            </div>\r\n                            <button type=\"button\" id=\"cart_btn\" className=\"btn btn-primary d-inline ml-4\" disabled={product.stock === 0} onClick={addToCart}>Thêm vào giỏ hàng</button>\r\n\r\n                            <hr />\r\n\r\n                            <p>Tình trạng hàng: <span id=\"stock_status\" className={product.stock > 0 ? 'greenColor' : 'redColor'} >{product.stock > 0 ? 'Còn hàng' : 'Hết hàng'}</span></p>\r\n\r\n                            <hr />\r\n\r\n                            <h4 className=\"mt-2\">Mô tả:</h4>\r\n                            <p>{product.description}</p>\r\n                            <hr />\r\n                            <p id=\"product_seller mb-3\">Xuất xứ: <strong>{product.seller}</strong></p>\r\n\r\n                            {user ? <button id=\"review_btn\" type=\"button\" className=\"btn btn-primary mt-4\" data-toggle=\"modal\" data-target=\"#ratingModal\" onClick={setUserRatings}>\r\n                                Bình luận sản phẩm\r\n                            </button>\r\n                                :\r\n                                <div className=\"alert alert-danger mt-5\" type='alert'>Bạn cần đăng nhập để có thể đánh giá được sản phẩm này.</div>\r\n                            }\r\n\r\n\r\n                            <div className=\"row mt-2 mb-5\">\r\n                                <div className=\"rating w-50\">\r\n\r\n                                    <div className=\"modal fade\" id=\"ratingModal\" tabIndex=\"-1\" role=\"dialog\" aria-labelledby=\"ratingModalLabel\" aria-hidden=\"true\">\r\n                                        <div className=\"modal-dialog\" role=\"document\">\r\n                                            <div className=\"modal-content\">\r\n                                                <div className=\"modal-header\">\r\n                                                    <h5 className=\"modal-title\" id=\"ratingModalLabel\">Đánh giá sản phẩm</h5>\r\n                                                    <button type=\"button\" className=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                                                        <span aria-hidden=\"true\">&times;</span>\r\n                                                    </button>\r\n                                                </div>\r\n                                                <div className=\"modal-body\">\r\n\r\n                                                    <ul className=\"stars\" >\r\n                                                        <li className=\"star\"><i className=\"fa fa-star\"></i></li>\r\n                                                        <li className=\"star\"><i className=\"fa fa-star\"></i></li>\r\n                                                        <li className=\"star\"><i className=\"fa fa-star\"></i></li>\r\n                                                        <li className=\"star\"><i className=\"fa fa-star\"></i></li>\r\n                                                        <li className=\"star\"><i className=\"fa fa-star\"></i></li>\r\n                                                    </ul>\r\n\r\n                                                    <textarea\r\n                                                        name=\"review\"\r\n                                                        id=\"review\" className=\"form-control mt-3\"\r\n                                                        value={comment}\r\n                                                        onChange={(e) => setComment(e.target.value)}\r\n                                                    >\r\n\r\n                                                    </textarea>\r\n                                                    {/* <button className=\"btn my-3 float-right px-4 text-white\" onClick={reviewHandler} data-dismiss=\"modal\" aria-label=\"Close\">hi</button> */}\r\n                                                    <button className=\"btn my-3 float-right review-btn px-4 bg-primary\" onClick={reviewHandler} data-dismiss=\"modal\" aria-label=\"Close\">Gửi bình luận</button>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className='container'>\r\n                        {product.reviews && product.reviews.length > 0 && (\r\n                            <ListReviews reviews={product.reviews} />\r\n                        )}\r\n                    </div>\r\n\r\n                </Fragment>\r\n            )}\r\n        </Fragment>\r\n    )\r\n}\r\n\r\nexport default ProductDetails\r\n"]},"metadata":{},"sourceType":"module"}